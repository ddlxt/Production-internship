# **智能软工课程助手系统 API 接口规格文档**

本接口文档涵盖智能软工课程助手系统的所有功能模块接口，包括前后端交互所使用的REST API接口。各接口按照功能模块分类，并详细描述接口名称、请求路径和方法、请求与响应参数格式，以及错误码含义和解决方案。所有接口返回数据均为 JSON 格式；除注册/登录等公开接口外，其余接口调用均需在请求头中携带有效的认证令牌（例如 `Authorization: Bearer <token>`），并由后端验证用户身份和权限。接口错误码遵循HTTP状态码规范，`code`字段为0表示成功，非0表示不同错误类型。下面按模块逐一列出接口规格。

## **用户认证与账户**

### **用户注册接口**

**请求URL**：`/api/register`  
**请求方法**：POST  
**接口功能**：用于注册新用户账户（支持学生或教师角色）。

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| useremail | string | 是 | 用户邮箱，作为登录账号；需为有效邮箱地址，且后缀域名在支持列表内（例如qq.com、163.com等） |
| username | string | 是 | 用户昵称或姓名 |
| password | string | 是 | 用户密码（明文）；客户端需确保一定的密码强度 |
| role | string | 是 | 用户角色，取值为 `"student"`（学生）或 `"teacher"`（教师） |

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| status | string | 请求结果状态，`"success"`表示成功，`"error"`表示失败 |
| message | string | 提示信息，注册成功时返回“注册成功”，失败时返回错误原因描述 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 信息不完整，请求缺少必要参数 | 确认请求体包含所有必须的字段（useremail、username、password、role） |
| 400 | 邮箱域名不支持，注册邮箱不在允许列表内 | 更换为系统支持的邮箱域名（如qq.com、163.com等常用邮箱）后重试 |
| 400 | 该邮箱已被注册，当前邮箱不可用 | 使用未注册过的邮箱进行注册，或直接登录已有账号 |
| 500 | 注册失败，服务器发生异常 | 稍后重试或联系管理员检查服务器状态 |

### **用户登录接口**

**请求URL**：`/api/login`  
**请求方法**：POST  
**接口功能**：用于账号登录，获取访问令牌。支持学生和教师账号登录。

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| useremail | string | 是 | 用户邮箱（登录账号） |
| password | string | 是 | 用户密码 |
| role | string | 是 | 用户角色，取值为 `"student"` 或 `"teacher"`，用于指明登录身份 |

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| status | string | 请求结果状态，`"success"`表示认证成功，`"error"`表示登录失败 |
| message | string | 提示信息，成功时返回“登录成功”，失败时返回错误原因 |
| data | object | 当登录成功时返回用户数据对象；登录失败时该字段可能为空或不返回 |
| data.token | string | 认证令牌(Token)，后续调用需要在请求头中携带此令牌 |
| data.expire\_at | integer | Token过期时间的时间戳（单位秒，自 Unix Epoch 起），登录成功后1小时过期 |
| data.username | string | 用户昵称或姓名 |
| data.role | string | 用户角色，`student` 或 `teacher`（与请求中的角色一致） |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 缺少字段，请求体不完整 | 确认提供了 useremail、password 和 role 字段 |
| 401 | 用户不存在或密码错误，登录凭证无效 | 确认邮箱已注册且密码输入正确 |
| 401 | 登录已失效，Token 无效或过期（访问需授权） | 重新登录获取有效Token，并在请求头提供 |
| 500 | 登录失败，服务器发生异常 | 稍后重试或联系管理员解决 |

### **发送重置密码验证码接口**

**请求URL**：`/api/reset-password/send-code`  
**请求方法**：POST  
**接口功能**：用于找回密码时发送邮箱验证码。用户提交邮箱地址，系统向该邮箱发送六位数字验证码邮件。

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| email | string | 是 | 用户注册邮箱 |
| role | string | 是 | 用户角色，`"student"` 或 `"teacher"`，用于确定查询对应用户表 |

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| status | string | 请求结果状态，`success` 表示发送成功，`error` 表示发送失败 |
| message | string | 提示信息，成功时通常为“验证码已发送”，失败时返回错误原因 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 缺少邮箱或身份，请求参数不完整 | 提供有效的邮箱地址和用户角色后重试 |
| 404 | 邮箱未注册，系统中无此邮箱对应的账号 | 确认邮箱拼写正确，或先完成用户注册 |
| 500 | 邮件发送失败，邮件服务异常 | 稍后重试，如果多次失败请联系管理员检查邮件服务 |

### **邮箱验证码重置密码接口**

**请求URL**：`/api/reset-password`  
**请求方法**：POST  
**接口功能**：利用邮箱验证码重置密码。用户提交收到的验证码和新密码，验证通过后更新账户密码。

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| email | string | 是 | 用户注册邮箱（接收验证码的邮箱） |
| verifyCode | string | 是 | 邮箱收到的6位验证码 |
| newPassword | string | 是 | 新的账户密码 |
| role | string | 是 | 用户角色，`"student"` 或 `"teacher"`，用于确定更新对应用户表 |

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| status | string | 操作结果，`success` 表示密码已成功重置，`error` 表示失败 |
| message | string | 提示信息，成功时返回“密码已重置”，失败时返回错误原因 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 信息不完整，提交的数据缺少必要字段 | 确认请求体包含邮箱、验证码、新密码和角色字段 |
| 400 | 验证码错误或已过期 | 使用正确的验证码（5分钟内有效），必要时重新获取 |
| 404 | 未找到账号，指定邮箱的用户不存在 | 确认邮箱和角色无误，确保账户已注册 |
| 500 | 密码重置失败，服务器更新过程中出现错误 | 稍后重试或联系管理员排查服务器问题 |

## **仪表盘与概要数据**

### **学生仪表盘数据接口**

**请求URL**：`/api/student/dashboard`  
**请求方法**：GET  
{  
    “useremail” :”[qiaoyanbo408@gmail.com](mailto:qiaoyanbo408@gmail.com)”  
    “token” : “114514xxxxx”  
}  
**接口功能**：获取学生主页仪表盘信息，包括加入的课程列表、待完成的作业任务以及教师反馈消息摘要等。仅限学生角色调用。

**请求参数**：无（需在请求头中携带学生用户的认证Token）。

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| courses\[\] | array | 我加入的课程列表，每个元素包含课程的简要信息 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 401 | 未登录，缺少有效认证 | 登录后重新请求，并在请求头提供Token |
| 403 | 权限不足，非学生角色尝试访问学生接口 | 使用正确的学生账号调用此接口 |
| 500 | 获取数据失败，服务器内部错误 | 稍后重试或联系管理员解决 |

### 

### **教师仪表盘数据接口**

**请求URL**：`/api/teacher/dashboard`  
**请求方法**：GET

**接口功能**：获取教师主页仪表盘信息，包括我创建的课程列表、待批改作业列表以及学生提问信息等概览。仅限教师角色调用。

**请求参数**：

{  
    “useremail” :”[qiaoyanbo408@gmail.com](mailto:qiaoyanbo408@gmail.com)”  
    “token” : “114514xxxxx”  
}

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| courses\[\] | array | 我加入的课程列表，每个元素包含课程的简要信息 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 401 | 未登录，无有效认证 | 登录教师账号后重试，并在请求头提供Token |
| 403 | 权限不足，非教师角色尝试访问教师接口 | 使用教师权限账号调用此接口 |
| 500 | 获取数据失败，服务器内部错误 | 稍后重试或联系管理员解决 |

## **课程管理接口**

### **教师创建课程接口**

**请求URL**：`/api/teacher/courses`  
**请求方法**：POST  
**接口功能**：教师创建新课程。仅教师角色可调用，创建后自己成为该课程的任课教师。

**“教师创建课程接口”请求参数表格：**

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| `token` | string | 是 | `token` |
| `useremail` | string | 是 | `useremail` |
| name | string | 是 | 新课程名称 |
| description | string | 否 | 课程描述信息（可选） |
| start\_time | datetime | 是 | 课程开始时间（ISO 8601 格式） |
| end\_time | datetime | 是 | 课程结束时间（ISO 8601 格式） |
| studentList\[\] | array (string) | 是 | 学生邮箱列表，数组中每个元素为一个学生邮箱 |

**说明：**

* **start\_time** 和 **end\_time** 的类型被指定为 \`datetime\`，并明确了需要使用 ISO 8601 格式的日期时间字符串，例如：\`2024-01-15T10:00:00+08:00\`。  
* **studentList\[\]** 的类型被指定为 \`array (string)\`，明确表示这是一个字符串数组，数组中的每个元素都是一个学生的邮箱地址。  
* 所有新增参数都被设置为 **必填**，

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| course | object | 新创建的课程信息对象 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 课程名称不能为空，未提供必需的课程名称 | 提供非空的课程名称后重新提交 |
| 401 | 未登录或无教师权限，无法创建课程 | 登录教师账号并确保具有教师权限后再操作 |
| 500 | 创建课程失败，服务器发生异常 | 稍后重试或联系管理员解决 |

### **学生获取课程详情接口**

**请求URL**：`/api/student/course`  
**请求方法**：GET  
**接口功能**：学生查看某课程的详细信息，包括课程基本信息和该课程下的作业列表及自己的提交情况。仅已加入课程的学生可访问。

**请求参数**：

{  
    “useremail” :”[qiaoyanbo408@gmail.com](mailto:qiaoyanbo408@gmail.com)”  
    “token” : “114514xxxxx”  
    “course\_id”: “rg\_01”  
}  
**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| course | object | 课程信息对象 |
| course.id | string | 课程ID（与请求路径中的ID相同） |
| course.name | string | 课程名称 |
| assignments | array | 当前课程的作业列表 |
| assignments\[\].id | string | 作业ID，格式如`course_<课程ID>_hw_<作业编号>` |
| assignments\[\].title | string | 作业标题 |
| assignments\[\].dueDate | string | 截止日期，格式为`YYYY-MM-DD`，如果没有截止日期则为`null` |
| assignments\[\].submitted | boolean | 是否已提交该作业（当前学生） |
| assignments\[\].score | integer | 得分，如果该作业已批改则显示分数，未批改或未提交则为`null` |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 课程ID无效，路径参数格式错误或无法解析 | 确认 `<course_id>` 格式正确（如`course_1`） |
| 403 | 未选该课程，学生不在此课程中无权查看 | 确认自己已加入该课程（通过选课接口加入）后再访问 |
| 404 | 课程不存在，指定的课程ID未找到 | 检查课程ID是否正确，如有疑问联系课程教师 |
| 401 | 未登录或身份无效（非学生身份） | 登录学生账号并携带有效Token后再访问 |

### **教师获取课程详情接口**

**请求URL**：`/api/teacher/course/<course_id>`  
**请求方法**：GET  
**接口功能**：教师查看自己创建的课程详情，包括课程基本信息和该课程下所有作业列表。仅课程的任课教师可访问。

**请求参数**：URL路径中包含课程ID（`<course_id>`）。需教师认证Token。

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| course | object | 课程信息对象 |
| course.id | string | 课程ID（与请求路径中的ID相同） |
| course.name | string | 课程名称 |
| assignments | array | 该课程下的作业列表 |
| assignments\[\].id | string | 作业ID，格式为`course_<课程ID>_hw_<作业编号>` |
| assignments\[\].title | string | 作业标题 |
| assignments\[\].dueDate | string | 截止日期，格式`YYYY-MM-DD`，若无截止日期则为`null` |
| assignments\[\].status | string | 作业状态，根据截止日期判断，值为“进行中”或“已截止” |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 课程ID无效，路径参数格式错误 | 确认 `<course_id>` 参数格式正确 |
| 404 | 课程不存在，指定ID的课程未找到 | 检查课程ID是否正确，如确认存在问题联系管理员 |
| 403 | 无权限访问该课程，当前教师非该课程创建者 | 使用该课程的任课教师账号登录后再访问 |
| 401 | 未登录或非教师身份，无权访问 | 确认已使用教师账号登录并携带有效认证信息 |

## **作业管理接口**

### **教师发布作业接口**

**请求URL**：`/api/teacher/course/assignments`  
**请求方法**：POST  
**接口功能**：教师在指定课程中布置新作业。仅课程的教师可调用。创建作业后，系统会为该课程生成一个新的作业记录及提交表。

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| title | string | 是 | 作业标题 |
| description | string | 否 | 作业描述/要求说明（可选） |
| dueDate | string | 否 | 截止日期，格式为`YYYY-MM-DD`（不填则表示不限截止日期） |
| referenceAnswer | string | 否 | 参考答案或评分标准说明（可选，可为文本内容） |

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| assignment | object | 新创建的作业信息对象 |
| assignment.id | string | 作业ID，格式如`course_<课程ID>_hw_<作业编号>`（作业编号从1开始递增） |
| assignment.title | string | 作业标题（与请求中提供的标题相同） |
| assignment.dueDate | string | 截止日期，格式`YYYY-MM-DD`，如果创建时未指定则为 null |
| assignment.status | string | 作业状态，“进行中”表示还未截止，“已截止”表示截止日期已过（若无截止日期则状态为空字符串） |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 标题不能为空，提交的作业标题为空 | 提供非空的作业标题后重新提交请求 |
| 400 | 课程ID无效，路径参数格式错误 | 确认 URL 路径中课程ID正确 |
| 404 | 课程不存在，指定课程ID未找到 | 检查课程ID是否正确，如确认存在联系管理员 |
| 403 | 无权限，在非本人任课的课程下尝试布置作业 | 使用该课程的任课教师账号进行操作 |
| 401 | 未登录或非教师身份，无权布置作业 | 登录教师账号并确保身份正确后再尝试 |
| 500 | 创建作业失败，服务器发生异常 | 稍后重试或联系管理员解决 |

### **学生获取作业详情接口**

**请求URL**：`/api/student/assignment/`  
**请求方法**：GET  
**接口功能**：学生查看指定作业的详细信息以及自己对此作业的提交情况和反馈。仅已选该课程且提交ID属于该学生的情况下可访问。

**请求参数**：URL路径中提供作业ID（`<assignment_id>`），格式形如`course_<课程ID>_hw_<作业编号>`。需学生认证Token。

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| assignment | object | 作业基本信息 |
| assignment.title | string | 作业标题 |
| assignment.description | string | 作业描述/要求（教师发布作业时填写的说明，没有则为空字符串） |
| assignment.dueDate | string | 截止日期，格式`YYYY-MM-DD`，若无截止日期则为 null |
| submission | object | **(可选)** 我的提交信息。如果当前学生已提交过该作业，则返回提交内容和反馈；若尚未提交则本字段不存在 |
| submission.content | string | 提交的答案内容。如有附件则为附件标识（文件ID），文本作答则为文本内容 |
| submission.submitTime | string | 提交时间，格式`YYYY-MM-DD HH:MM:SS` |
| submission.score | integer | 得分，如已批改则为分数，未批改或未评分则为 null |
| submission.feedback | string | 教师/AI给出的反馈评语，如无反馈则为空字符串 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 作业ID无效，路径参数格式不正确 | 确认 `<assignment_id>` 格式正确，如`course_2_hw_1` |
| 403 | 无权访问该作业，学生未加入对应课程或尝试访问他人作业 | 确认已选修该课程且仅请求自己的作业ID |
| 404 | 作业不存在，指定的作业未找到 | 检查课程ID和作业编号是否正确，如有疑问联系任课教师 |
| 401 | 未登录或非学生身份，无权限查看 | 登录学生账号并确保携带有效Token后重试 |

### **教师获取作业详情接口**

**请求URL**：`/api/teacher/assignment/<assignment_id>`  
**请求方法**：GET  
**接口功能**：教师查看指定作业的详情以及所有学生的提交情况。仅任课教师可访问。教师可据此批改作业。

**请求参数**：URL路径中提供作业ID（`<assignment_id>`），格式为`course_<课程ID>_hw_<作业编号>`。需教师认证Token。

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| assignment | object | 作业基本信息 |
| assignment.title | string | 作业标题 |
| assignment.description | string | 作业描述/要求说明（教师发布时填写的内容） |
| assignment.dueDate | string | 截止日期，格式`YYYY-MM-DD`，无截止日期则为 null |
| submissions | array | 学生提交列表 |
| submissions\[\].studentEmail | string | 学生邮箱（提交者标识） |
| submissions\[\].studentName | string | 学生姓名（如有，则为该邮箱对应用户的姓名） |
| submissions\[\].content | string | 提交内容：如果是文本答案则直接为文本，如果为附件则提供下载链接 |
| submissions\[\].score | integer | 作业得分，若尚未批改则为 null |
| submissions\[\].feedback | string | 批改反馈评语，若尚未填写则为空字符串 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 作业ID无效，路径参数格式错误 | 确认 `<assignment_id>` 参数格式正确 |
| 404 | 课程或作业不存在，指定课程ID或作业编号未找到 | 检查assignment\_id中的课程部分和编号部分是否正确 |
| 403 | 无权限访问该作业，当前教师并非此课程的任课教师 | 使用正确的任课教师账号访问 |
| 401 | 未登录或非教师身份，无权查看 | 登录教师账号并确保Token有效后再试 |

### **学生提交作业接口**

**请求URL**：`/api/student/assignment/<assignment_id>/submit`  
**请求方法**：POST  
**接口功能**：学生提交作业答案。仅课程的学生可以提交各自的作业答案，每名学生对每份作业仅允许提交一次（当前版本）。支持文本答案或附件提交。

**请求参数**：

URL路径提供作业ID（`<assignment_id>`，格式`course_<课程ID>_hw_<作业编号>`）。请求体为JSON，字段如下：

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| content | string | 是 | 提交内容：可以是文本答案，也可以是上传文件的标识ID（通过文件上传接口获得）。 |

**说明**：如果有附件，需要先通过文件上传接口获得文件ID，然后在此处将 content 设置为该文件ID；若为纯文本回答，则直接将回答内容作为 content。

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| submission | object | 提交结果信息 |
| submission.content | string | 提交内容回显，与请求中的 content 相同（文本或文件ID） |
| submission.submitTime | string | 提交时间，格式`YYYY-MM-DD HH:MM:SS` |
| submission.score | integer | 得分，提交时默认无评分，返回 null |
| submission.feedback | string | 反馈评语，初始为空字符串 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 没有提交内容，请求体缺少 content 或 content 为空 | 确认填写了答案内容或正确上传附件后重试 |
| 400 | 作业ID无效，路径参数格式错误 | 确认 `<assignment_id>` 格式正确 |
| 403 | 无权提交此作业，学生未加入对应课程 | 加入课程后方可提交该课程的作业 |
| 400 | 请勿重复提交，已经提交过该作业 | 每个作业只需提交一次，无需重复提交 |
| 401 | 未登录或非学生身份，无权限提交 | 登录学生账号并确保身份后重新提交 |
| 500 | 提交失败，服务器存储发生错误 | 稍后重试或联系管理员解决 |

### **教师提交作业评分接口**

**请求URL**：`/api/teacher/assignment/<assignment_id>/grade`  
**请求方法**：POST  
**接口功能**：教师批改学生作业并提交评分和评语。教师可对指定作业下某一位学生的提交进行评分。每次调用针对单个学生的作业提交记录进行更新。仅任课教师可调用。

**请求参数**：

URL路径提供作业ID（`<assignment_id>`），格式`course_<课程ID>_hw_<作业编号>`。请求体为JSON，包含以下字段：

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| studentEmail | string | 是 | 学生邮箱，指定要批改的提交所属学生 |
| score | integer | 是 | 评分分数（0\~100的整数） |
| feedback | string | 否 | 评语反馈（可选，不提供则默认为空） |

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| message | string | 操作结果信息，如“评分已保存”表示批改提交成功 |
| status | string | 操作状态，成功时为 `"success"`，失败为 `"error"` |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 参数不完整，studentEmail 或 score 未提供 | 确认请求体包含 studentEmail 和 score 字段 |
| 400 | 作业ID无效，路径参数格式错误 | 确认 `<assignment_id>` 格式正确 |
| 403 | 无权限，当前教师无权批改该课程作业 | 用任课教师账号批改属于自己课程的作业 |
| 404 | 学生不在该课程中，指定的 studentEmail 非本课程学生 | 确认学生邮箱无误且该学生确已加入课程 |
| 401 | 未登录或非教师身份，无权限批改 | 登录任课教师账号并确保身份有效后重试 |
| 500 | 提交成绩失败，服务器内部错误 | 稍后重试或联系管理员处理 |

## **作业批改与智能反馈接口**

## AI 批量批改作业接口（教师）

|  |  |
| :---- | :---- |
| **接口名称** | AI 批量批改作业 |
| **请求 URL** | `/api/teacher/assignment/auto-grade` |
| **请求方法** | `POST` |
| **接口功能** | 一键触发 AI 自动批改指定作业下所有“未评分”提交。调用成功仅表示批改任务**已启动**（异步执行）；实际批改结果需稍后通过“批改结果列表查询接口”轮询获取。**仅任课教师**可调用。 |

### 请求参数

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| `token` | string | 是 | 认证令牌，格式：`Bearer <token>` |
| `useremail` | string | 是 | 教师登录邮箱，用于再次核验调用者身份 |
| `courseId` | string | 是 | 课程 ID，如 `course_1` |
| `homeworkId` | string | 是 | 作业 ID（作业编号或业务侧主键），对应 `<assignment_id>` 中的具体作业 |

**请求示例**

POST /api/teacher/assignment/auto-grade

{

    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"

    "useremail": "teacher@example.com",

    "courseId":  "course\_1",

    "homeworkId": "hw\_2"

}

### 成功响应

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| `status` | string | `"success"` |
| `message` | string | 固定返回 “批改任务已启动” |

{

    "status": "success",

    "message": "批改任务已启动"

}

### 失败响应及错误码

| HTTP / 业务码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| `400` | 参数缺失或格式错误（如缺少 useremail / courseId / homeworkId） | 检查请求体与路径参数，补全后重试 |
| `401` | 未认证或令牌无效 | 重新登录获取有效 Token |
| `403` | 调用者无任课权限或 useremail 与课程不匹配 | 使用正确的任课教师账号及邮箱 |
| `404` | 课程 / 作业不存在 | 核实 courseId 和 homeworkId |
| `500` | 任务触发失败，服务器异常 | 稍后重试或联系管理员 |

### 说明

1. **幂等性**：若重复调用同一作业的自动批改接口且仍存在“未评分”提交，系统会继续尝试批改剩余提交；否则立即返回成功且不重复批改。  
2. **安全校验**：后端将同时校验 `Authorization` 中的令牌、`useremail` 与教师身份、以及 `courseId` / `homeworkId` 与 `<assignment_id>` 的一致性，任何一步不符都将返回 `403`。  
3. **异步处理**：启动任务后即返回；批改进度及结果请使用 “批改结果列表查询接口” 轮询。

### **批改结果列表查询接口 （教师）**

**请求URL**：`/api/teacher/assignment/feedbacks`  
**请求方法**：GET  
**接口功能**：教师查询指定作业下所有提交的批改结果列表。可用于轮询查看AI批改完成情况。返回每个学生提交的当前评分和反馈状态。仅任课教师可调用。

**请求参数**：

{

    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9"

    "useremail": "teacher@example.com",

    "courseId":  "course\_1",

    "homeworkId": "hw\_2"  
        }

**响应参数**：

将feedback压缩成zip然后返回

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 作业ID无效，路径参数格式错误 | 确认 `<assignment_id>` 格式正确 |
| 403 | 无权限查看，当前教师非该课程任课教师 | 使用任课教师账号调用该接口 |
| 404 | 作业不存在，指定ID未找到 | 检查 assignment\_id 是否正确 |
| 401 | 未登录或非教师身份，无权限 | 登录教师账号并确保Token有效后重试 |
| 500 | 批改结果查询失败，服务器内部错误或AI结果获取异常 | 稍后重试，若持续出现问题请联系管理员 |

### **提交最终反馈接口 （教师）**

**请求URL**：`/api/submissions/feedback`  
**请求方法**：PUT  
**接口功能**：教师确认或修改AI批改结果，提交最终评分和反馈。用于在AI批改完成后，教师调整评分或编辑反馈评语并保存。提交成功后，学生将能看到最终确定的成绩和反馈。仅任课教师可调用。

**请求参数**：URL路径中提供提交记录ID（`<submission_id>`）。请求体为JSON，字段如下：

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| useremail |  | 是 |  |
| token |  | 是 |  |
| score | integer | 是 | 最终确定的分数（如果需要修改AI给出的分数） |
| feedback | string | 是 | 最终反馈评语（如果需要编辑AI给出的评语） |
| course\_id | string |  |  |
| homework\_id |  |  |  |
| student | string |  | 被确认成绩的学生的邮箱 |

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| status | string | 操作结果状态，成功返回 `"success"`，失败返回 `"error"` |
| message | string | 提示信息，成功时如“反馈已更新”，失败时返回错误原因 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 404 | 提交记录不存在，submission\_id 未找到 | 确认提交记录ID正确，必要时通过查询接口获取正确ID |
| 403 | 无权限操作，当前教师无权修改该提交反馈 | 使用任课教师账号并确保针对自己课程的提交进行操作 |
| 401 | 未登录或非教师身份，无权限 | 登录教师账号并确保Token有效后重试 |
| 500 | 提交反馈失败，服务器内部错误 | 稍后重试或联系管理员处理 |

**注意**：submission\_id 通常由系统生成用于唯一标识一条作业提交记录。在当前实现中，每份提交记录可能通过组合键标识（课程ID+学生ID），实际部署中可改为单表管理提交记录并使用自增ID。

## **智能问答助手接口**

### **AI 对话提问接口**

**请求URL**：`/api/assist/chat`  
**请求方法**：POST  
**接口功能**：学生向AI助手提问的对话接口。前端将学生的问题发送至该接口，后台调用智能模型获取回答并返回。支持上下文对话，可选提供课程或作业相关上下文。

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
| :---- | :---- | :---- | :---- |
| message | string | 是 | 学生提问内容（自然语言问题） |
| context | object | 否 | 对话上下文信息（可选），包含以下可选字段： |
| context.courseId | string | 否 | 课程ID，如提问与特定课程相关，可提供以便检索课件/资料 |
| context.assignmentId | string | 否 | 作业ID，如提问与某次作业相关，可提供以便参考作业要求/答案 |
| context.conversationId | string | 否 | 会话ID，用于多轮对话时维持上下文关联 |

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| answer | string | AI助手的回答内容（针对提问的解答） |
| conversationId | string | （可选）会话ID。如果请求中未提供会话ID，系统新建对话则返回新的 conversationId，用于后续多轮对话 |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | 提问内容为空，message 字段未提供或为空 | 确认提供了非空的问题内容后重新发送请求 |
| 401 | 未登录或无访问权限 | 登录学生账号后重试，并确保携带有效的认证信息 |
| 500 | AI回答失败，后台智能服务发生错误或无响应 | 稍后重试。如持续失败，请联系管理员检查AI服务状态 |

**说明**：实际部署中，为提高对话实时性，可以升级为 WebSocket 长连接实现双向通信。本接口为简化设计的HTTP版本，每次请求得到一次答复。如果需要多轮对话，请在后续请求中附带上一次返回的 conversationId 以保留上下文。AI 回答内容基于课程知识库和智能体协作生成，可能会引用教材或资料片段以保证准确性。

## **文件上传与下载接口**

### **上传文件接口**

**请求URL**：`/api/v1/uploadfile`  
**请求方法**：POST  
**接口功能**：通用文件上传接口。支持教师上传作业附件或学生上传作业答案中的图片等文件。文件将存储在服务器，返回文件标识供后续下载或引用。

**请求参数**：使用表单（multipart/form-data）格式上传文件。表单字段说明：

* `file`：要上传的文件对象（二进制内容）。  
    
* 其他字段如`fileType`、`userId`、`uploadTime`等为可选元数据，当前实现未强制使用。

**响应参数**：

| 字段 | 类型 | 说明 |
| :---- | :---- | :---- |
| code | integer | 错误码，`0` 表示成功，非0表示失败（如400表示请求有误，500表示服务器错误等） |
| message | string | 提示信息，成功时返回 "Upload success"，失败时返回错误原因 |
| data | object | 上传成功时返回的文件信息对象，失败时为 `null` |
| data.fileId | string | 文件ID，上传成功后生成的文件唯一标识（用于下载引用） |
| data.fileName | string | 原始文件名 |
| data.fileUrl | string | 文件下载URL，通过该链接可直接获取文件（与下述下载接口等效） |
| data.contentType | string | 文件类型（MIME Type） |
| data.size | integer | 文件大小（字节数） |
| data.uploadedAt | string | 上传时间（UTC时间，ISO格式字符串） |

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 400 | No file provided，未提供文件内容 | 确认表单中包含 `file` 字段并选择了文件后重试 |
| 500 | Upload failed，服务器保存文件失败 | 稍后重试，若多次失败请联系管理员检查服务器存储 |

**注意**：本接口对上传文件大小和类型可根据需要进行限制，如限制最大文件大小或允许的文件类型。在当前实现中，所有文件都会被存储，并返回一个文件ID用于引用。请妥善保存返回的 fileId 以便在提交作业时使用。

### **文件下载接口**

**请求URL**：`/api/v1/files/<file_id>`  
**请求方法**：GET  
**接口功能**：文件下载/获取接口。根据文件ID获取上传的文件内容。前端可使用该接口将文件展示给用户或下载到本地。

**请求参数**：URL路径中提供文件标识 `<file_id>`，即上传成功后获得的 fileId。无需请求体。

**响应**：二进制文件数据。成功时，HTTP响应直接返回文件内容（并包含适当的`Content-Type`和`Content-Disposition`头用于提示下载）；失败时返回JSON错误信息。

**错误码**：

| 错误码 | 含义 | 解决方案 |
| :---- | :---- | :---- |
| 404 | 文件不存在，指定的 file\_id 未找到 | 确认文件ID正确无误，并且该文件已上传成功 |
| 401 | 未授权或会话失效，无权访问文件 | 确认用户已登录并有权限访问该文件（如作业附件仅课程成员可看） |
| 500 | 文件获取失败，服务器内部错误 | 稍后重试或联系管理员检查服务器存储 |

**说明**：文件下载接口对权限的控制可以根据业务需要调整，例如只有课程教师或提交者本人可下载查看某些文件。在当前实现中，上传的文件默认可通过文件ID直接获取，建议对敏感文件增加权限校验。返回的文件名为上传时保存的名称（系统可能重命名文件以避免冲突）。调用该接口时浏览器会弹出下载或直接展示取决于文件类型。  